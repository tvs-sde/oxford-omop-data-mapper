<Query>
    <Sql>
select distinct
    -- NHS Number: unique patient identifier, used to link to the person table.
    Record ->> '$.LinkagePatientId.NhsNumber.@extension' as NhsNumber,
    -- Date of non primary cancer diagnosis (clinically agreed): used as condition_start_date for transformation.
    -- Currently a string in CCYY-MM-DD format; will be cast to date in a later ETL step.
    Record ->> '$.NonPrimaryPathway.DateOfNonPrimaryCancerDiagnosisClinicallyAgreed' as DateOfNonPrimaryCancerDiagnosisClinicallyAgreed,
    -- Original Morphology SNOMED: the SNOMED code or SNOMED CT concept ID for the original primary diagnosis before cancer transformation.
    -- Agreed at the multidisciplinary team meeting by the care professional team.
    -- Will be mapped to a standard OMOP condition_concept_id via vocabulary lookup in a later step.
    -- Stored as condition_source_value in the condition_occurrence table.
    Record ->> '$.NonPrimaryPathway.Transformation.OriginalMorphologySnomed.@code' as OriginalMorphologySnomed
from omop_staging.cosd_staging_901
where type = 'HA'
  and NhsNumber is not null
  and OriginalMorphologySnomed is not null;
	</Sql>
    <Explanations>
	    <Explanation columnName="NhsNumber">
		    <Description>Patient NHS Number, the primary identifier for a person in NHS England and Wales.</Description>
		    <Origin>NHS NUMBER</Origin>
	    </Explanation>
	    <Explanation columnName="DateOfNonPrimaryCancerDiagnosisClinicallyAgreed">
		    <Description>The date where the non primary cancer patient diagnosis was confirmed or agreed. Normally the date of the authorized pathology laboratory service report confirming the diagnosis.</Description>
		    <Origin>DATE OF NON PRIMARY CANCER DIAGNOSIS (CLINICALLY AGREED)</Origin>
	    </Explanation>
	    <Explanation columnName="OriginalMorphologySnomed">
		    <Description>SNOMED code or SNOMED CT concept ID for the morphology code of the original primary diagnosis of the cancer transformation during a Cancer Care Spell. Equivalent to the CLINICAL TERMINOLOGY CODE attribute. Agreed at the multidisciplinary team meeting by the care professional team.</Description>
		    <Origin>MORPHOLOGY (SNOMED CANCER TRANSFORMATION ORIGINAL)</Origin>
	    </Explanation>
    </Explanations>
</Query>
